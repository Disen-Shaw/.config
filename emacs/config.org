
#+TITLE: My GNU EMACS CONFIGURATION
#+AUTHOR: Disen-Shaw
#+STARTUP: content

* BASIC UI CONFIGURATION

** BASIC UI

#+begin_src emacs-lisp
  ;; disable auto-backup ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  (setq make-backup-files nil)
  (setq auto-save-default nil)
  ;; disable menu bar
  (menu-bar-mode -1)
  ;; disable tool bar
  (tool-bar-mode -1)
  ;; disable tool bar
  (scroll-bar-mode -1)
  ;; display line numbers
  (setq display-line-numbers-type 't)
  (global-display-line-numbers-mode t)
  ;; disable startup buffer
  (setq inhibit-startup-screen t)        
#+end_src

** FONTS

#+begin_src emacs-lisp
  ;; I use Maple Mono NF CN
  (defun emacs_basic_settings/setup-fonts ()
    (set-face-attribute 'default nil :font "Maple Mono NF CN-12")
    (set-fontset-font t 'han (font-spec :family "Maple Mono NF CN-12"))
    (set-fontset-font t 'emoji (font-spec :family "Noto Color Emoji"))
    (setq-default line-spacing 0.2)
    (setq org-src-fontify-natively t))
  ;; for emacs --daemon server mode 
  (when (display-graphic-p)
    (emacs_basic_settings/setup-fonts))
  (add-hook 'after-make-frame-functions
  	  (lambda (frame)
  	    (with-selected-frame frame
  	      (when (display-graphic-p frame)
  		(emacs_basic_settings/setup-fonts)))))  
#+end_src

* ELPACA PACKAGE MANAGER
#+begin_src emacs-lisp
  (defvar elpaca-installer-version 0.11)
  (defvar elpaca-directory (expand-file-name "elpaca/" user-emacs-directory))
  (defvar elpaca-builds-directory (expand-file-name "builds/" elpaca-directory))
  (defvar elpaca-repos-directory (expand-file-name "repos/" elpaca-directory))
  (defvar elpaca-order '(elpaca :repo "https://github.com/progfolio/elpaca.git"
                                :ref nil :depth 1 :inherit ignore
                                :files (:defaults "elpaca-test.el" (:exclude "extensions"))
                                :build (:not elpaca--activate-package)))
  (let* ((repo  (expand-file-name "elpaca/" elpaca-repos-directory))
         (build (expand-file-name "elpaca/" elpaca-builds-directory))
         (order (cdr elpaca-order))
         (default-directory repo))
    (add-to-list 'load-path (if (file-exists-p build) build repo))
    (unless (file-exists-p repo)
      (make-directory repo t)
      (when (<= emacs-major-version 28) (require 'subr-x))
      (condition-case-unless-debug err
          (if-let* ((buffer (pop-to-buffer-same-window "*elpaca-bootstrap*"))
                    ((zerop (apply #'call-process `("git" nil ,buffer t "clone"
                                                    ,@(when-let* ((depth (plist-get order :depth)))
                                                        (list (format "--depth=%d" depth) "--no-single-branch"))
                                                    ,(plist-get order :repo) ,repo))))
                    ((zerop (call-process "git" nil buffer t "checkout"
                                          (or (plist-get order :ref) "--"))))
                    (emacs (concat invocation-directory invocation-name))
                    ((zerop (call-process emacs nil buffer nil "-Q" "-L" "." "--batch"
                                          "--eval" "(byte-recompile-directory \".\" 0 'force)")))
                    ((require 'elpaca))
                    ((elpaca-generate-autoloads "elpaca" repo)))
              (progn (message "%s" (buffer-string)) (kill-buffer buffer))
            (error "%s" (with-current-buffer buffer (buffer-string))))
        ((error) (warn "%s" err) (delete-directory repo 'recursive))))
    (unless (require 'elpaca-autoloads nil t)
      (require 'elpaca)
      (elpaca-generate-autoloads "elpaca" repo)
      (let ((load-source-file-function nil)) (load "./elpaca-autoloads"))))
  (add-hook 'after-init-hook #'elpaca-process-queues)
  (elpaca `(,@elpaca-order))
  (elpaca elpaca-use-package
    ;; Enable use-package :ensure support for Elpaca.
    (elpaca-use-package-mode))

#+end_src

* PACKAGE CONFIGURATION

** RESOURCE PACKAGE

*** UI RESOURCE

#+begin_src emacs-lisp
  ;; icons
  (use-package all-the-icons
    :ensure t
    :config
    (setq all-the-icons-scale-factor 1.4))
  ;; nerd icons
  (use-package nerd-icons
    :ensure t)
#+end_src

*** OTHER FUNCTIONAL RESOURCE
**** which-key

which-key package for keymap description.

#+begin_src emacs-lisp
  (use-package which-key
    :ensure t
    :config
    (which-key-mode)
    (setq which-key-idle-delay 0.2))
#+end_src

**** neotree

#+begin_src emacs-lisp
  (use-package neotree
    :ensure t
    :config
    (setq neo-theme 'nerd-icons) 
    (setq neo-smart-open t)
    (setq neo-window-fixed-size nil)
    (setq neo-show-hidden-files t)
    (setq neo-autorefresh nil))
#+end_src

**** eshell terminal

#+begin_src emacs-lisp
  (defun my/toggle-eshell ()
    "Toggle a bottom eshell window."
    (interactive)
    (let* ((buf (get-buffer "*eshell*")))
      ;; 如果不存在，创建一个
      (unless buf
        (save-window-excursion
  	(eshell))
        (setq buf (get-buffer "*eshell*")))

      ;; 如果已经显示 → 收回
      (if (get-buffer-window buf)
  	(progn
            (bury-buffer buf)
            (delete-window (get-buffer-window buf)))
        ;; 否则弹出并切换过去
        (let ((win (display-buffer-in-side-window
                    buf
                    '((side . bottom)
                      (slot . 0)
                      (window-height . 0.3)))))
  	(select-window win)))))
#+end_src

**** magit
#+begin_src emacs-lisp
  (use-package transient
    :ensure t)

  (use-package magit
    :ensure t)
#+end_src

** EVIL MODE
*** EVIL PACKAGES

#+begin_src emacs-lisp
  (setq evil-want-keybinding nil)
  (setq evil-want-integration t)

  (use-package evil
    :ensure t
    :demand t
    :config

    ;; my vim keymap ;;;;;;;;;;;;;;;;;;;
    (evil-define-motion my/evil/move-down-5-lines (count)
      "Move down 5 lines."
      :type line
      (evil-next-line (or count 5)))
    (evil-define-motion my/evil/move-up-5-lines (count)
      "Move down 5 lines."
      :type line
      (evil-previous-line (or count 5)))
    (evil-define-motion my/evil/move-beginning-of-line ()
      "Move to beginning of current line."
      :type exclusive
      (evil-first-non-blank))
    (evil-define-motion my/evil/move-end-of-line ()
      "Move to end of current line."
      :type exclusive
      (evil-end-of-line))
    (evil-mode 1))

  (use-package evil-collection
    :ensure t
    :after evil
    :config
    (evil-collection-init))

  ;; jk for normal mode
  (use-package evil-escape
    :ensure t
    :after evil
    :config
    (evil-escape-mode)
    (setq evil-escape-key-sequence "jk"
          evil-escape-delay 0.15))

#+end_src

** GENERAL

#+begin_src emacs-lisp
  (use-package general
    :ensure t
    :config
    (general-create-definer leader-key
      :states '(normal visual)
      :keymaps 'override
      :prefix "SPC")

    ;; my personal vim keymap
    (general-define-key
     :states '(normal visual)
     "J" #'my/evil/move-down-5-lines
     "K" #'my/evil/move-up-5-lines
     "H" #'my/evil/move-beginning-of-line
     "L" #'my/evil/move-end-of-line
     "S" #'save-buffer)

    ;; window operation
    (general-define-key
     :states '(normal)
     :keymaps 'override
     :prefix "<tab>"
     "h" 'evil-window-left
     "l" 'evil-window-right
     "k" 'evil-window-up
     "j" 'evil-window-down
     "t" 'neotree-toggle
     )

    ;; eshell
    (general-define-key
     :states '(normal insert visual)
     "C-t" #'my/toggle-eshell
     )
    )
#+end_src

** COMPLETION
*** FRONTEND

**** crofu

#+begin_src emacs-lisp
  (use-package corfu
    :ensure t
    :init
    (global-corfu-mode)
    :custom
    (corfu-auto t)
    (corfu-auto-delay 0.1)
    (corfu-auto-prefix 1)          ;; 输入 1 个字符就触发
    (corfu-quit-no-match 'separator)
    (corfu-cycle t)                ;; TAB 循环候选项
    (corfu-preselect 'prompt))
#+end_src

**** kind-icon

#+begin_src emacs-lisp
  (use-package kind-icon
    :ensure t
    :after corfu
    :custom
    (kind-icon-default-face 'corfu-default) ; 让图标背景跟随主题
    :config
    (add-to-list 'corfu-margin-formatters #'kind-icon-margin-formatter))
#+end_src

**** vertico

#+begin_src emacs-lisp
  (use-package vertico
    :ensure t
    :init (vertico-mode))
#+end_src

**** orderless

#+begin_src emacs-lisp
  (use-package orderless
    :ensure t
    :custom (completion-styles '(orderless))
    (completion-category-overrides '((file (styles basic partial-completion)))))
#+end_src

*** BACKEND

**** cape
#+begin_src emacs-lisp
  (use-package cape
    :ensure t
    :init
    (add-to-list 'completion-at-point-functions #'cape-dabbrev)
    (add-to-list 'completion-at-point-functions #'cape-file)
    (add-to-list 'completion-at-point-functions #'cape-keyword))
  ;; tab configuration
  (with-eval-after-load 'corfu
    (define-key corfu-map (kbd "TAB") #'corfu-next)
    (define-key corfu-map (kbd "<tab>") #'corfu-next)
    (define-key corfu-map (kbd "<backtab>") #'corfu-previous))
#+end_src

**** LSP

#+begin_src emacs-lisp
  (use-package flymake
    :ensure nil)

  (use-package eglot
    :ensure nil
    ;; cc-mode programing
    :hook ((c-mode c++-mode) . eglot-ensure))
#+end_src

** UI PACKAGES

*** DASHBOARD

#+begin_src emacs-lisp
  (use-package dashboard
    :ensure t
    :config
    (dashboard-setup-startup-hook)
    ;; display logo
    (setq dashboard-hide-mode-line t)
    (setq dashboard-startup-banner 'official)
    ;; display information
    (setq dashboard-items '((recents . 5)
  			  (projects . 5)
  			  (bookmarks . 5)))
    ;; display tips 
    (setq dashboard-banner-logo-title "hello world")
    ;; random
    (setq dashboard-center-content t)
    (setq dashboard-show-shortcuts nil))
#+end_src

*** DOOM-MODELINE

#+begin_src emacs-lisp
  (use-package doom-modeline
    :ensure t
    :init
    (doom-modeline-mode 1)
    :custom
    (setq-default line-spacing 0.2)
    (doom-modeline-height 32)          ;; 状态栏高度
    (doom-modeline-bar-width 4)        ;; 左侧彩条宽度
    (doom-modeline-buffer-file-name-style 'truncate-upto-project)
    (doom-modeline-icon t)             ;; 显示图标
    (doom-modeline-major-mode-icon t)
    (doom-modeline-major-mode-color-icon t)
    (doom-modeline-lsp t)              ;; 显示 LSP 状态
    (doom-modeline-github nil)
    (doom-modeline-mu4e nil)
    (doom-modeline-irc nil))
#+end_src

*** DOOM-THEMES

#+begin_src emacs-lisp
  (use-package doom-themes
    :ensure t
    :config
    (setq doom-themes-visual-bell nil
  	doom-modeline-enable-visual-bell nil)
    (load-theme 'doom-dracula t)
    (doom-themes-org-config))
#+end_src


