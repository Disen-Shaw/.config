
#+TITLE: My GNU Emacs Configuration 
#+AUTHOR: Disen-Shaw (DS)
#+STARTUP: content

* TABLE OF DOC :toc:
- [[#basic-ui-configuration][BASIC UI CONFIGURATION]]
  - [[#basic-ui][BASIC UI]]
  - [[#fonts][FONTS]]
- [[#elpaca-package-manager][ELPACA PACKAGE MANAGER]]
- [[#package-configuration][PACKAGE CONFIGURATION]]
  - [[#resource-package][RESOURCE PACKAGE]]
  - [[#evil-mode][EVIL MODE]]
  - [[#completion][COMPLETION]]
  - [[#general][GENERAL]]
  - [[#document][Document]]
  - [[#ui-packages][UI PACKAGES]]

* BASIC UI CONFIGURATION

** BASIC UI

#+begin_src emacs-lisp
  ;; disable auto-backup ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  (setq make-backup-files nil)
  (setq auto-save-default nil)

  ;; shut the fxxking up
  (setq ring-bell-function 'ignore)

  ;; disable menu bar
  (menu-bar-mode -1)
  ;; disable tool bar
  (tool-bar-mode -1)
  ;; disable tool bar
  (scroll-bar-mode -1)
  ;; display line numbers
  (setq display-line-numbers-type 't)
  (global-display-line-numbers-mode t)
  ;; disable startup buffer
  (setq inhibit-startup-screen t)        
#+end_src

** FONTS

#+begin_src emacs-lisp
  ;; I use Maple Mono NF CN
  (defun emacs_basic_settings/setup-fonts ()
    (set-face-attribute 'default nil :font "Maple Mono NF CN-12")
    (set-fontset-font t 'han (font-spec :family "Maple Mono NF CN-12"))
    (set-fontset-font t 'emoji (font-spec :family "Noto Color Emoji"))

  (when (display-graphic-p)
    (set-fontset-font t 'unicode "Symbols Nerd Font Mono" nil 'append)
    (set-fontset-font t 'symbol  "Symbols Nerd Font Mono" nil 'append)
    (set-fontset-font t 'emoji   "Symbols Nerd Font Mono" nil 'append))

    (setq-default line-spacing 0.2)
    (setq org-src-fontify-natively t))
  ;; for emacs --daemon server mode 
  (when (display-graphic-p)
    (emacs_basic_settings/setup-fonts))
  (add-hook 'after-make-frame-functions
  	  (lambda (frame)
  	    (with-selected-frame frame
  	      (when (display-graphic-p frame)
  		(emacs_basic_settings/setup-fonts)))))  
#+end_src

* ELPACA PACKAGE MANAGER
#+begin_src emacs-lisp
  (defvar elpaca-installer-version 0.11)
  (defvar elpaca-directory (expand-file-name "elpaca/" user-emacs-directory))
  (defvar elpaca-builds-directory (expand-file-name "builds/" elpaca-directory))
  (defvar elpaca-repos-directory (expand-file-name "repos/" elpaca-directory))
  (defvar elpaca-order '(elpaca :repo "https://github.com/progfolio/elpaca.git"
                                :ref nil :depth 1 :inherit ignore
                                :files (:defaults "elpaca-test.el" (:exclude "extensions"))
                                :build (:not elpaca--activate-package)))
  (let* ((repo  (expand-file-name "elpaca/" elpaca-repos-directory))
         (build (expand-file-name "elpaca/" elpaca-builds-directory))
         (order (cdr elpaca-order))
         (default-directory repo))
    (add-to-list 'load-path (if (file-exists-p build) build repo))
    (unless (file-exists-p repo)
      (make-directory repo t)
      (when (<= emacs-major-version 28) (require 'subr-x))
      (condition-case-unless-debug err
          (if-let* ((buffer (pop-to-buffer-same-window "*elpaca-bootstrap*"))
                    ((zerop (apply #'call-process `("git" nil ,buffer t "clone"
                                                    ,@(when-let* ((depth (plist-get order :depth)))
                                                        (list (format "--depth=%d" depth) "--no-single-branch"))
                                                    ,(plist-get order :repo) ,repo))))
                    ((zerop (call-process "git" nil buffer t "checkout"
                                          (or (plist-get order :ref) "--"))))
                    (emacs (concat invocation-directory invocation-name))
                    ((zerop (call-process emacs nil buffer nil "-Q" "-L" "." "--batch"
                                          "--eval" "(byte-recompile-directory \".\" 0 'force)")))
                    ((require 'elpaca))
                    ((elpaca-generate-autoloads "elpaca" repo)))
              (progn (message "%s" (buffer-string)) (kill-buffer buffer))
            (error "%s" (with-current-buffer buffer (buffer-string))))
        ((error) (warn "%s" err) (delete-directory repo 'recursive))))
    (unless (require 'elpaca-autoloads nil t)
      (require 'elpaca)
      (elpaca-generate-autoloads "elpaca" repo)
      (let ((load-source-file-function nil)) (load "./elpaca-autoloads"))))
  (add-hook 'after-init-hook #'elpaca-process-queues)
  (elpaca `(,@elpaca-order))
  (elpaca elpaca-use-package
    ;; Enable use-package :ensure support for Elpaca.
    (elpaca-use-package-mode))

#+end_src

* PACKAGE CONFIGURATION
** RESOURCE PACKAGE

*** UI RESOURCE
**** all the icons
#+begin_src emacs-lisp
  ;; icons
  (use-package all-the-icons
    :ensure t
    :if (display-graphic-p)
    :config
    (setq all-the-icons-scale-factor 1.4))

  ;; dired icons
  (use-package all-the-icons-dired
    :ensure t
    :hook
    (dired-mode . (lambda () (all-the-icons-dired-mode 1))))
#+end_src

**** nerd icons

#+begin_src emacs-lisp
  ;; nerd icons
  (use-package nerd-icons
    :ensure t)
#+end_src

*** OTHER FUNCTIONAL RESOURCE
**** which-key

which-key package for keymap description.

#+begin_src emacs-lisp
  (use-package which-key
    :ensure t
    :init 
    (which-key-mode 1)
    :config
    (setq which-key-side-window-location 'bottom
  	which-key-sort-order #'which-key-key-order
  	which-key-allow-imprecise-window-fit nil
  	which-key-sort-uppercase-first nil
  	which-key-add-column-padding 1
  	which-key-max-display-columns nil
  	which-key-min-display-lines 6
  	which-key-side-window-slot -10
  	which-key-side-window-max-height 0.5
  	which-key-idle-delay 0.8
  	which-key-max-description-length 25
  	which-key-allow-imprecise-window-fit nil
  	which-key-separator " → " ))
#+end_src

**** neotree

#+begin_src emacs-lisp
  (use-package neotree
    :ensure t
    :config
    (setq neo-theme 'nerd-icons) 
    (setq neo-smart-open t)
    (setq neo-window-fixed-size nil)
    (setq neo-show-hidden-files t)
    (setq neo-autorefresh nil))
#+end_src

**** eshell terminal

#+begin_src emacs-lisp
  (defun my/toggle-eshell ()
    "Toggle a bottom eshell window."
    (interactive)
    (let* ((buf (get-buffer "*eshell*")))
      ;; 如果不存在，创建一个
      (unless buf
        (save-window-excursion
  	(eshell))
        (setq buf (get-buffer "*eshell*")))

      ;; 如果已经显示 → 收回
      (if (get-buffer-window buf)
  	(progn
            (bury-buffer buf)
            (delete-window (get-buffer-window buf)))
        ;; 否则弹出并切换过去
        (let ((win (display-buffer-in-side-window
                    buf
                    '((side . bottom)
                      (slot . 0)
                      (window-height . 0.3)))))
  	(select-window win)))))
#+end_src

**** magit
#+begin_src emacs-lisp
  (use-package transient
    :ensure t)

  (use-package magit
    :ensure t)
#+end_src
**** sudo edit

#+begin_src emacs-lisp
  (use-package sudo-edit
    :ensure t)
#+end_src
** EVIL MODE
*** EVIL PACKAGES

#+begin_src emacs-lisp

  (use-package evil
    :ensure t
    :init 
    (setq evil-want-keybinding nil)
    (setq evil-want-integration t)
    :demand t
    :config
    ;; my vim keymap ;;;;;;;;;;;;;;;;;;;
    (evil-define-motion my/evil/move-down-5-lines (count)
      "Move down 5 lines."
      :type line
      (evil-next-line (or count 5)))
    (evil-define-motion my/evil/move-up-5-lines (count)
      "Move down 5 lines."
      :type line
      (evil-previous-line (or count 5)))
    (evil-define-motion my/evil/move-beginning-of-line ()
      "Move to beginning of current line."
      :type exclusive
      (evil-first-non-blank))
    (evil-define-motion my/evil/move-end-of-line ()
      "Move to end of current line."
      :type exclusive
      (evil-end-of-line))
    (evil-mode 1))

  (use-package evil-collection
    :ensure t
    :after evil
    :config
    (evil-collection-init))

  ;; jk for normal mode
  (use-package evil-escape
    :ensure t
    :after evil
    :config
    (evil-escape-mode)
    (setq evil-escape-key-sequence "jk"
          evil-escape-delay 0.15))

#+end_src

** COMPLETION
*** IVY

A generic completion mechanism for emacs.

#+begin_src emacs-lisp
  (use-package ivy
    :ensure t
    :custom
    (setq ivy-use-virtual-buffers t)
    (setq ivy-count-format "(%d/%d) ")
    (setq enable-recursive-minibuffers t)
    :config
    (ivy-mode))
#+end_src

*** IVY-RICH

Allow us to add description alongside the command in M-x.

#+begin_src emacs-lisp
  ;; icons
  (use-package all-the-icons-ivy-rich
    :ensure t
    :init
    (all-the-icons-ivy-rich-mode 1))

  (use-package ivy-rich
    :ensure t
    :after ivy
    :init
    (ivy-rich-mode 1)
    :custom
    (ivy-virtual-abbreviate 'full
  			  ivy-rich-switch-buffer-align-virtual-buffer t
  			  ivy-rich-path-style 'abbrev)
    :config
    (ivy-set-display-transformer 'ivy-switch-buffer
                                 'ivy-rich-switch-buffer-transformer))

#+end_src

*** COUNSEL

A collection of ivy-enhanced version of common emacs command.

#+begin_src emacs-lisp
  (use-package counsel
    :ensure t
    :after ivy
    :config
    (counsel-mode))
#+end_src

** GENERAL

#+begin_src emacs-lisp
  (use-package general
    :ensure t
    :config
    (general-evil-setup)
    (general-create-definer leader-key
      :states '(normal visual)
      :keymaps 'override
      :prefix "SPC"
      :global-prefix "M-SPC") ;; access leader in insert mode

    (leader-key
      ;; buffer management
      "b"   '(:ignore t :wk "buffer management")
      "b b" '(switch-to-buffer t :wk "switch buffer")
      "b i" '(ibuffer t :wk "list all buffers")
      "b k" '(kill-current-buffer t :wk "kill this buffer")
      "b n" '(next-buffer t :wk "next buffer")
      "b p" '(previous-buffer t :wk "previous buffer")
      "b r" '(revert-buffer t :wk "reload buffer")

      ;; helo information
      "h"   '(:ignore t :wk "help")
      "hf"  '(describe-function :wk "describe function")
      "hv"  '(describe-variable :wk "describe variable")
      "hm"  '(describe-mode :wk "describe mode")
      "hrr" '((lambda () (interactive)
  	      (load-file "~/.config/emacs/init.el")
  	      (load-file "~/.config/emacs/init.el"))
  	    :wk "reload emacs config")

      ;; file
      "f"   '(:ignore t :wk "file operation")
      "f c" '((lambda () (interactive) (find-file "~/.config/emacs/config.org")) :wk "edit config.org")
      "f r" '(counsel-recentf :wk "find recent files.")
      "f u" '(sudo-edit-find-file :wk "sudo find file")
      "f U" '(sudo-edit :wk "sudo edit file")
      "." '(find-file :wk "find file"))

    ;; normal and visual mode keymap
    (general-define-key
     :states '(normal visual)
     "J" #'my/evil/move-down-5-lines
     "K" #'my/evil/move-up-5-lines
     "H" #'my/evil/move-beginning-of-line
     "L" #'my/evil/move-end-of-line
     "S" #'save-buffer
     "gc" #'comment-line)
    
    ;; window operation
    (general-define-key
     :states '(normal)
     :keymaps 'override
     :prefix "<tab>"
     "h" '(evil-window-left :wk "switch to left window")
     "l" '(evil-window-right :wk "switch to right window")
     "k" '(evil-window-up :wk "switch to above window")
     "j" '(evil-window-down :wk "switch to below window")
     "t" '(neotree-toggle :wk "neotree"))

    ;; eshell
    (general-define-key
     :states '(normal insert visual)
     "C-t" #'my/toggle-eshell
     )
    )
#+end_src

** Document
*** ORG-MODE
**** org-mode rendering

Enabling table of contents

#+begin_src emacs-lisp
  (use-package toc-org
    :ensure t
    :commands toc-org-enable
    :init (add-hook 'org-mode-hook 'toc-org-enable))
#+end_src

Enabling org bullets

#+begin_src emacs-lisp
  (add-hook 'org-mode-hook 'org-indent-mode)
  (use-package org-bullets
    :ensure t)
  (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))
#+end_src

**** source code block tag expansion

| Typing the below + TAB | Expands to ...                          |
|------------------------+-----------------------------------------|
| <a                     | '#+BEGIN_EXPORT ascii' … '#+END_EXPORT  |
| <c                     | '#+BEGIN_CENTER' … '#+END_CENTER'       |
| <C                     | '#+BEGIN_COMMENT' … '#+END_COMMENT'     |
| <e                     | '#+BEGIN_EXAMPLE' … '#+END_EXAMPLE'     |
| <E                     | '#+BEGIN_EXPORT' … '#+END_EXPORT'       |
| <h                     | '#+BEGIN_EXPORT html' … '#+END_EXPORT'  |
| <l                     | '#+BEGIN_EXPORT latex' … '#+END_EXPORT' |
| <q                     | '#+BEGIN_QUOTE' … '#+END_QUOTE'         |
| <s                     | '#+BEGIN_SRC' … '#+END_SRC'             |
| <v                     | '#+BEGIN_VERSE' … '#+END_VERSE'         |

#+begin_src emacs-lisp
  (require 'org-tempo)
#+end_src

** UI PACKAGES

*** DASHBOARD

#+begin_src emacs-lisp
  (use-package dashboard
    :ensure t
    :config
    (dashboard-setup-startup-hook)
    ;; display logo
    (setq dashboard-hide-mode-line t)
    (setq dashboard-startup-banner 'official)
    ;; display information
    (setq dashboard-items '((recents . 5)
  			  (projects . 5)
  			  (bookmarks . 5)))
    ;; display tips 
    (setq dashboard-banner-logo-title "hello world")
    ;; random
    (setq dashboard-center-content t)
    (setq dashboard-show-shortcuts nil))
#+end_src

*** DOOM-MODELINE

#+begin_src emacs-lisp
  (use-package doom-modeline
    :ensure t
    :init
    (doom-modeline-mode 1)
    :custom
    (setq-default line-spacing 0.2)
    (doom-modeline-height 32)          ;; 状态栏高度
    (doom-modeline-bar-width 4)        ;; 左侧彩条宽度
    (doom-modeline-buffer-file-name-style 'truncate-upto-project)
    (doom-modeline-icon t)             ;; 显示图标
    (doom-modeline-major-mode-icon t)
    (doom-modeline-major-mode-color-icon t)
    (doom-modeline-lsp t)              ;; 显示 LSP 状态
    (doom-modeline-github nil)
    (doom-modeline-mu4e nil)
    (doom-modeline-irc nil))
#+end_src

*** DOOM-THEMES

#+begin_src emacs-lisp
  (use-package doom-themes
    :ensure t
    :config
    (setq doom-themes-visual-bell nil
  	doom-modeline-enable-visual-bell nil)
    (load-theme 'doom-dracula t)
    (doom-themes-org-config))
#+end_src





















